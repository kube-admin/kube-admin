services:
  # 后端服务
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: kube-admin-backend
    restart: unless-stopped
    environment:
      - PORT=8080
      - KUBECONFIG=/app/config/kubeconfig
      - JWT_SECRET=your-secret-key-change-in-production
    volumes:
      - ./backend/data:/app/data  # 挂载数据目录，持久化数据库
      - ./backend/config:/app/config  # 挂载配置目录
    ports:
      - "8080:8080"
    networks:
      - kube-admin-network
    command: ["./main"]

  # 前端服务
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: kube-admin-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - kube-admin-network

# 定义网络
networks:
  kube-admin-network:
    driver: bridge

# 定义卷
volumes:
  kube-admin-db-data:
    driver: local
